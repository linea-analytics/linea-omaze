<!doctype html>
<html lang="en-GB" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scenario Planning Tool</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- App styles -->
  <link rel="stylesheet" href="./assets/css/styles.css" />
</head>

<body class="bg-body">
  <!-- Top bar -->
  <header class="app-topbar border-bottom">
    <div class="container py-3 d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-2">
        <div class="brand-mark">L</div>
        <div class="lh-sm">
          <div class="fw-semibold">Scenario Planning Tool</div>
          <div class="text-secondary small">Lottery marketing optimisation demo</div>
        </div>
      </div>

      <div class="d-flex align-items-center gap-2">
        <button id="btnHelp" class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-info-circle me-1"></i> Optimisation notes
        </button>
        <button id="btnReset" class="btn btn-outline-danger btn-sm">
          <i class="bi bi-arrow-counterclockwise me-1"></i> Reset
        </button>
      </div>
    </div>
  </header>

  <main class="container py-4">
    <!-- Progress -->
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div class="small text-secondary">
        Step <span id="stepNum">1</span> of 5
      </div>
      <div class="progress flex-grow-1 mx-3" style="height: 8px;">
        <div id="stepProgress" class="progress-bar" role="progressbar" style="width: 20%"></div>
      </div>
      <div class="small text-secondary d-none d-md-block">
        <span id="stepLabel">Home</span>
      </div>
    </div>

    <!-- Views -->
    <section id="viewHome" class="view">
      <div class="p-4 p-md-5 rounded-4 hero-surface shadow-sm border">
        <div class="row align-items-center g-4">
          <div class="col-lg-7">
            <h1 class="display-6 fw-semibold mb-2">Scenario Planning Tool</h1>
            <p class="lead text-secondary mb-4">
              Running optimisations to generate the ideal marketing strategy for every outcome.
            </p>

            <button id="btnCreateScenario" class="btn btn-primary btn-lg px-4">
              <i class="bi bi-plus-circle me-2"></i> Create a Scenario
            </button>

            <div class="mt-4 small text-secondary">
              This is a static demo: curves are generated in-browser, then a discrete allocator assigns budget.
            </div>
          </div>

          <div class="col-lg-5">
            <div class="card border-0 shadow-sm rounded-4">
              <div class="card-body p-4">
                <div class="d-flex align-items-center gap-3 mb-3">
                  <div class="icon-bubble">
                    <i class="bi bi-graph-up-arrow"></i>
                  </div>
                  <div>
                    <div class="fw-semibold">What you will do</div>
                    <div class="text-secondary small">Plan draws, pick channels, set budget, run optimisation.</div>
                  </div>
                </div>

                <ul class="list-unstyled mb-0 small">
                  <li class="d-flex gap-2 mb-2"><i class="bi bi-check2 text-success"></i> 5 prize categories (XXL, XL, L, M, S)</li>
                  <li class="d-flex gap-2 mb-2"><i class="bi bi-check2 text-success"></i> 10 channels (toggles)</li>
                  <li class="d-flex gap-2 mb-2"><i class="bi bi-check2 text-success"></i> Monthly flighting calendar</li>
                  <li class="d-flex gap-2"><i class="bi bi-check2 text-success"></i> Spend matrix with databars</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="powered-by mt-4 text-center">
          Powered by <span class="powered-brand">linea</span>
        </div>
      </div>
    </section>

    <section id="viewPlan" class="view d-none">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <div>
          <h2 class="h4 mb-1">Scenario plan</h2>
          <div class="text-secondary">Set campaign live months for each prize draw category.</div>
        </div>
        <div class="text-secondary small">
          Tip: click cells in the calendar to toggle months.
        </div>
      </div>

      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div id="planTables" class="vstack gap-4"></div>
        </div>
      </div>

      <div class="nav-row">
        <button class="btn btn-outline-secondary" data-nav="prev"><i class="bi bi-arrow-left me-2"></i>Prev</button>
        <button class="btn btn-primary" data-nav="next">Next<i class="bi bi-arrow-right ms-2"></i></button>
      </div>

      <div class="powered-by small text-center">
        Powered by <span class="powered-brand">linea</span>
      </div>
    </section>

    <section id="viewChannels" class="view d-none">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <div>
          <h2 class="h4 mb-1">Marketing channels</h2>
          <div class="text-secondary">Toggle channels included in the optimisation.</div>
        </div>
        <div class="text-secondary small">
          All selected by default.
        </div>
      </div>

      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div id="channelGrid" class="channel-grid"></div>
        </div>
      </div>

      <div class="nav-row">
        <button class="btn btn-outline-secondary" data-nav="prev"><i class="bi bi-arrow-left me-2"></i>Prev</button>
        <button class="btn btn-primary" data-nav="next">Next<i class="bi bi-arrow-right ms-2"></i></button>
      </div>

      <div class="powered-by small text-center">
        Powered by <span class="powered-brand">linea</span>
      </div>
    </section>

    <section id="viewRun" class="view d-none">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <div>
          <h2 class="h4 mb-1">Run scenario</h2>
          <div class="text-secondary">Name it, set a budget, then run and save.</div>
        </div>
      </div>

      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-4">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Scenario name</label>
              <input id="scenarioName" class="form-control" placeholder="e.g. Spring draws, performance-heavy" />
              <div class="form-text">Stored locally in your browser.</div>
            </div>

            <div class="col-md-6">
              <label class="form-label">Total budget (EUR)</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-currency-euro"></i></span>
                <input id="scenarioBudget" type="number" class="form-control" min="0" step="10000" value="300000" />
              </div>
              <div class="form-text">Discrete step size: 10,000.</div>
            </div>

            <div class="col-12">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mt-2">
                <div class="text-secondary small" id="runSummary"></div>
                <button id="btnRunSave" class="btn btn-primary btn-lg">
                  <i class="bi bi-play-circle me-2"></i> Run and save
                </button>
              </div>
              <div id="runStatus" class="mt-3 d-none">
                <div class="d-flex align-items-center gap-2 text-secondary">
                  <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
                  <div>Running optimisation…</div>
                </div>
              </div>
              <div id="runError" class="alert alert-danger mt-3 d-none"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="nav-row">
        <button class="btn btn-outline-secondary" data-nav="prev"><i class="bi bi-arrow-left me-2"></i>Prev</button>
        <div class="text-secondary small">Next appears after a successful run.</div>
      </div>

      <div class="powered-by small text-center">
        Powered by <span class="powered-brand">linea</span>
      </div>
    </section>

    <section id="viewResult" class="view d-none">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
        <div>
          <h2 class="h4 mb-1">View scenario</h2>
          <div class="text-secondary" id="resultMeta"></div>
        </div>

        <div class="d-flex gap-2">
          <button id="btnDownloadJson" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-download me-1"></i> Export JSON
          </button>
          <button id="btnNewScenario" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle me-1"></i> New scenario
          </button>
        </div>
      </div>

      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table align-middle mb-0" id="resultTable"></table>
          </div>
        </div>
      </div>

      <div class="nav-row">
        <button class="btn btn-outline-secondary" data-nav="prev"><i class="bi bi-arrow-left me-2"></i>Prev</button>
        <button class="btn btn-outline-secondary" data-nav="home"><i class="bi bi-house me-2"></i>Home</button>
      </div>

      <div class="powered-by small text-center">
        Powered by <span class="powered-brand">linea</span>
      </div>
    </section>

    <!-- Optimisation notes modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Optimisation notes</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="text-secondary">
              This demo uses a discrete allocator that repeatedly assigns the next 10k to the eligible curve with the
              best incremental uplift (a practical “hill climb” style approach with stepwise marginal gains). The steps
              align with the incremental uplift workflow described in the companion markdown. :contentReference[oaicite:2]{index=2}
            </p>

            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-file-earmark-text"></i>
              <a href="./optim-algo.md" target="_blank" rel="noreferrer">Open optim-algo.md</a>
            </div>

            <hr />

            <div class="small text-secondary">
              Implementation detail: curves are generated per (channel x prize category), then replicated per month. When
              you select months in the plan, the optimiser only includes those month-specific curves.
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" data-bs-dismiss="modal">Done</button>
          </div>
        </div>
      </div>
    </div>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App scripts -->
  <script type="module" src="./assets/js/app.js"></script>
</body>
</html>
